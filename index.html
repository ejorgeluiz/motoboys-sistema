<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Presta√ß√£o de Contas - Motoboys - Cal√ßados 24h</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .tabs {
            background: #34495e;
            display: flex;
            justify-content: center;
            gap: 0;
        }

        .tab-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover, .tab-btn.active {
            background: white;
            color: #2c3e50;
            border-bottom-color: #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            padding: 25px;
            background: #f8f9fa;
            border-bottom: 1px solid #e1e8ed;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2c3e50;
            font-size: 13px;
        }

        input, select, textarea {
            padding: 10px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 3px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .btn-info {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 11px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
            background: #f8f9fa;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .positive { color: #27ae60; }
        .negative { color: #e74c3c; }
        .info { color: #3498db; }
        .warning { color: #f39c12; }

        .preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
            border-left: 4px solid #3498db;
        }

        .table-container {
            background: white;
            margin: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .table-header {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 10px 6px;
            text-align: center;
            font-weight: 600;
            font-size: 11px;
        }

        td {
            padding: 8px 6px;
            border-bottom: 1px solid #e1e8ed;
            text-align: center;
            font-size: 11px;
        }

        tr:hover td {
            background-color: #f8f9fa;
        }

        .rota-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .rota-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-left: 4px solid #3498db;
        }

        .rota-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e1e8ed;
        }

        .rota-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }

        .rota-totals {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .total-row.final {
            border-top: 2px solid #ddd;
            padding-top: 8px;
            font-weight: bold;
            font-size: 1em;
            color: #2c3e50;
        }

        .pedidos-list {
            max-height: 200px;
            overflow-y: auto;
            background: #fff;
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
        }

        .pedido-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            border-bottom: 1px solid #f1f2f6;
            font-size: 0.85em;
        }

        .pedido-item:last-child {
            border-bottom: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 25px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e1e8ed;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .date-range {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .rota-badge {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 5px;
        }

        .rota-badge.diurna {
            background: #f39c12;
        }

        .rota-badge.noturna {
            background: #9b59b6;
        }

        .rota-badge.especial {
            background: #e74c3c;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .rota-cards {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 10px;
            }
            
            th, td {
                padding: 6px 3px;
            }

            .date-range {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèçÔ∏è Controle de Presta√ß√£o de Contas - Motoboys</h1>
            <p>Sistema Detalhado: Pedido por Pedido ‚Üí Totais por Rota</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('pedidos')">üìù Cadastrar Pedidos</button>
            <button class="tab-btn" onclick="showTab('motoboys')">üë• Gerenciar Motoboys</button>
            <button class="tab-btn" onclick="showTab('rotas')">üõ£Ô∏è Resumo por Rotas</button>
            <button class="tab-btn" onclick="showTab('relatorio')">üìä Relat√≥rios</button>
        </div>

        <!-- ESTAT√çSTICAS GERAIS -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value info" id="totalPedidos">0</div>
                <div class="stat-label">Total Pedidos</div>
            </div>
            <div class="stat-card">
                <div class="stat-value positive" id="totalPedidosHoje">0</div>
                <div class="stat-label">Pedidos Hoje</div>
            </div>
            <div class="stat-card">
                <div class="stat-value warning" id="totalValorRota">R$ 0,00</div>
                <div class="stat-label">Valor Total Rotas</div>
            </div>
            <div class="stat-card">
                <div class="stat-value negative" id="totalValorFinal">R$ 0,00</div>
                <div class="stat-label">Valor Final a Receber</div>
            </div>
        </div>

        <!-- ABA 1: CADASTRAR PEDIDOS -->
        <div id="pedidos" class="tab-content active">
            <div class="form-section">
                <h2>üìù Cadastro Individual de Pedidos</h2>
                <div class="form-grid">
                    <div class="input-group">
                        <label for="motoboy">Motoboy</label>
                        <select id="motoboy">
                            <option value="">Selecione ou cadastre novo</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="novoMotoboy">Novo Motoboy</label>
                        <input type="text" id="novoMotoboy" placeholder="Nome do novo motoboy">
                    </div>
                    <div class="input-group">
                        <label for="telefone">Telefone</label>
                        <input type="tel" id="telefone" placeholder="(11) 99999-9999">
                    </div>
                    <div class="input-group">
                        <label for="data">Data</label>
                        <input type="date" id="data">
                    </div>
                    <div class="input-group">
                        <label for="nomeRota">üõ£Ô∏è Nome da Rota</label>
                        <input type="text" id="nomeRota" placeholder="Digite o nome da rota">
                    </div>
                    <div class="input-group">
                        <label for="numeroPedido">N¬∫ Pedido</label>
                        <input type="text" id="numeroPedido" placeholder="Ex: #001, PED-123">
                    </div>
                    <div class="input-group">
                        <label for="dinheiroRecebido">üíµ Dinheiro Recebido</label>
                        <input type="number" id="dinheiroRecebido" step="0.01" placeholder="0.00">
                    </div>
                    <div class="input-group">
                        <label for="valorRota">üí∞ Valor da Rota</label>
                        <input type="number" id="valorRota" step="0.01" placeholder="0.00">
                    </div>
                    <div class="input-group">
                        <label for="desconto">üí≥ Desconto</label>
                        <input type="number" id="desconto" step="0.01" placeholder="0.00">
                    </div>
                    <div class="input-group">
                        <label for="troco">üîÑ Troco</label>
                        <input type="number" id="troco" step="0.01" placeholder="0.00">
                    </div>
                    <div class="input-group">
                        <label for="dinheiroRetido">üè™ Dinheiro Retido</label>
                        <input type="number" id="dinheiroRetido" step="0.01" placeholder="0.00">
                    </div>
                    <div class="input-group full-width">
                        <label for="observacoes">üìù Observa√ß√µes</label>
                        <textarea id="observacoes" placeholder="Observa√ß√µes sobre o pedido (opcional)"></textarea>
                    </div>
                </div>
                
                <div class="preview" id="previewCalculo">
                    üí° Preencha os valores para ver o c√°lculo: Valor da Rota - Desconto - Troco - Dinheiro Retido
                </div>
                
                <div style="text-align: center;">
                    <button class="btn btn-success" onclick="adicionarPedido()">‚ûï Adicionar Pedido</button>
                    <button class="btn btn-warning" onclick="gerarExcel()">üìä Gerar Excel</button>
                    <button class="btn btn-danger" onclick="limparTudo()">üóëÔ∏è Limpar Tudo</button>
                </div>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h3>üìã Pedidos Cadastrados</h3>
                    <div>
                        <select id="filtroMotoboy" onchange="filtrarTabela()">
                            <option value="">Todos os motoboys</option>
                        </select>
                        <select id="filtroRota" onchange="filtrarTabela()" style="margin-left: 10px;">
                            <option value="">Todas as rotas</option>
                        </select>
                        <input type="date" id="filtroData" onchange="filtrarTabela()" style="margin-left: 10px;">
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Nome da Rota</th>
                            <th>N¬∫ Pedido</th>
                            <th>Motoboy</th>
                            <th>Dinheiro Recebido</th>
                            <th>Valor da Rota</th>
                            <th>Desconto</th>
                            <th>Troco</th>
                            <th>Dinheiro Retido</th>
                            <th>Valor Final</th>
                            <th>Observa√ß√µes</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaPedidos">
                        <tr>
                            <td colspan="12" style="text-align: center; color: #7f8c8d; padding: 40px;">
                                Nenhum pedido cadastrado ainda. Use o formul√°rio acima para adicionar.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ABA 2: GERENCIAR MOTOBOYS -->
        <div id="motoboys" class="tab-content">
            <div class="form-section">
                <h2>üë• Gerenciar Motoboys</h2>
                <p>Aqui voc√™ pode visualizar e editar informa√ß√µes dos motoboys cadastrados.</p>
            </div>

            <div class="table-container">
                <div class="table-header">
                    <h3>üìã Motoboys Cadastrados</h3>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Telefone</th>
                            <th>Total Pedidos</th>
                            <th>√öltimo Pedido</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaMotoboys">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #7f8c8d; padding: 40px;">
                                Nenhum motoboy cadastrado ainda.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ABA 3: ROTAS AGRUPADAS -->
        <div id="rotas" class="tab-content">
            <div class="form-section">
                <h2>üõ£Ô∏è Controle de Rotas por Motoboy</h2>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <label>Filtrar por data:</label>
                    <input type="date" id="filtroDataRota" onchange="atualizarRotas()">
                    <select id="filtroRotaTipo" onchange="atualizarRotas()">
                        <option value="">Todas as rotas</option>
                    </select>
                    <button class="btn" onclick="copiarResumoRotas()">üìã Copiar Resumo</button>
                    <button class="btn btn-warning" onclick="enviarWhatsAppRotas()">üì± Enviar WhatsApp</button>
                </div>
            </div>

            <div class="rota-cards" id="rotasContainer">
                <!-- Cards de rotas ser√£o gerados aqui -->
            </div>
        </div>

        <!-- ABA 4: RELAT√ìRIOS -->
        <div id="relatorio" class="tab-content">
            <div class="form-section">
                <h2>üìä Relat√≥rios Detalhados</h2>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <select id="tipoRelatorio" onchange="toggleDateInputs()">
                        <option value="diario">Relat√≥rio Di√°rio</option>
                        <option value="intervalo">Relat√≥rio por Intervalo</option>
                        <option value="semanal">Relat√≥rio Semanal</option>
                        <option value="mensal">Relat√≥rio Mensal</option>
                        <option value="motoboy">Por Motoboy</option>
                        <option value="rota">Por Tipo de Rota</option>
                    </select>
                    
                    <div class="date-range" id="dateInputs">
                        <input type="date" id="dataRelatorio" style="display: block;">
                        <span id="dateRangeLabel" style="display: none;">at√©</span>
                        <input type="date" id="dataRelatorioFim" style="display: none;">
                    </div>
                    
                    <select id="motoboyRelatorio">
                        <option value="">Todos os motoboys</option>
                    </select>
                    <select id="rotaRelatorio">
                        <option value="">Todas as rotas</option>
                    </select>
                    <button class="btn" onclick="gerarRelatorioDetalhado()">üìä Gerar Relat√≥rio</button>
                </div>
            </div>

            <div id="relatorioContent" class="table-container" style="display: none;">
                <div class="table-header">
                    <h3 id="relatorioTitulo">Relat√≥rio</h3>
                    <button class="btn btn-success" onclick="copiarRelatorio()">üìã Copiar Relat√≥rio</button>
                </div>
                <div id="relatorioTexto" style="padding: 20px; font-family: monospace; white-space: pre-line; background: #f8f9fa;"></div>
            </div>
        </div>
    </div>

    <!-- Modal para editar motoboy -->
    <div id="modalEditarMotoboy" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Editar Motoboy</h3>
                <span class="close" onclick="fecharModal()">&times;</span>
            </div>
            <div class="form-grid">
                <div class="input-group">
                    <label for="editNomeMotoboy">Nome</label>
                    <input type="text" id="editNomeMotoboy" readonly>
                </div>
                <div class="input-group">
                    <label for="editTelefoneMotoboy">Telefone</label>
                    <input type="tel" id="editTelefoneMotoboy" placeholder="(11) 99999-9999">
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="salvarEdicaoMotoboy()">üíæ Salvar</button>
                <button class="btn" onclick="fecharModal()">‚ùå Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        let pedidos = [];
        let motoboysData = {}; // {nome: {telefone: '', ultimoPedido: ''}}
        let rotasDisponiveis = new Set();
        let contador = 1;
        let motoboyEditando = '';

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('data').value = hoje;
            document.getElementById('filtroDataRota').value = hoje;
            document.getElementById('dataRelatorio').value = hoje;
            configurarEventListeners();
        });

        function configurarEventListeners() {
            // Calcular automaticamente o valor final
            ['valorRota', 'desconto', 'troco', 'dinheiroRetido'].forEach(id => {
                document.getElementById(id).addEventListener('input', calcularPreview);
            });

            // Auto-preencher telefone
            document.getElementById('motoboy').addEventListener('change', function() {
                const motoboyNome = this.value;
                if (motoboyNome && motoboysData[motoboyNome]) {
                    document.getElementById('telefone').value = motoboysData[motoboyNome].telefone;
                    document.getElementById('novoMotoboy').value = '';
                }
            });

            // Limpar select ao digitar novo
            document.getElementById('novoMotoboy').addEventListener('input', function() {
                if (this.value) {
                    document.getElementById('motoboy').value = '';
                    document.getElementById('telefone').value = '';
                }
            });
        }

        function toggleDateInputs() {
            const tipo = document.getElementById('tipoRelatorio').value;
            const dataRelatorio = document.getElementById('dataRelatorio');
            const dataRelatorioFim = document.getElementById('dataRelatorioFim');
            const dateRangeLabel = document.getElementById('dateRangeLabel');
            
            if (tipo === 'intervalo') {
                dataRelatorio.style.display = 'block';
                dataRelatorioFim.style.display = 'block';
                dateRangeLabel.style.display = 'block';
            } else {
                dataRelatorio.style.display = 'block';
                dataRelatorioFim.style.display = 'none';
                dateRangeLabel.style.display = 'none';
            }
        }

        function calcularPreview() {
            const valorRota = parseFloat(document.getElementById('valorRota').value) || 0;
            const desconto = parseFloat(document.getElementById('desconto').value) || 0;
            const troco = parseFloat(document.getElementById('troco').value) || 0;
            const dinheiroRetido = parseFloat(document.getElementById('dinheiroRetido').value) || 0;
            
            const valorFinal = valorRota - desconto - troco - dinheiroRetido;
            
            const preview = document.getElementById('previewCalculo');
            
            if (valorFinal > 0) {
                preview.innerHTML = `üí∞ <span style="color: #27ae60;">Valor Final: R$ ${valorFinal.toFixed(2)} (Motoboy recebe)</span>`;
            } else if (valorFinal < 0) {
                preview.innerHTML = `üí∏ <span style="color: #e74c3c;">Valor Final: R$ ${Math.abs(valorFinal).toFixed(2)} (Valor negativo)</span>`;
            } else if (valorRota > 0) {
                preview.innerHTML = `‚úÖ <span style="color: #3498db;">Valor Final: R$ 0,00 (Contas zeradas)</span>`;
            } else {
                preview.innerHTML = `üí° F√≥rmula: Valor da Rota - Desconto - Troco - Dinheiro Retido`;
            }
        }

        function obterCorRota(nomeRota) {
            if (nomeRota.toLowerCase().includes('diurna') || nomeRota.toLowerCase().includes('dia')) {
                return 'diurna';
            } else if (nomeRota.toLowerCase().includes('noturna') || nomeRota.toLowerCase().includes('noite')) {
                return 'noturna';
            } else if (nomeRota.toLowerCase().includes('especial')) {
                return 'especial';
            }
            return '';
        }

        // GERENCIAMENTO DE ABAS
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            if (tabId === 'rotas') {
                atualizarRotas();
            } else if (tabId === 'motoboys') {
                atualizarTabelaMotoboys();
            }
        }

        // ADICIONAR PEDIDO
        function adicionarPedido() {
            const motoboySelect = document.getElementById('motoboy').value;
            const novoMotoboy = document.getElementById('novoMotoboy').value.trim();
            const telefone = document.getElementById('telefone').value.trim();
            const data = document.getElementById('data').value;
            const nomeRota = document.getElementById('nomeRota').value.trim();
            const numeroPedido = document.getElementById('numeroPedido').value.trim();
            const dinheiroRecebido = parseFloat(document.getElementById('dinheiroRecebido').value) || 0;
            const valorRota = parseFloat(document.getElementById('valorRota').value) || 0;
            const desconto = parseFloat(document.getElementById('desconto').value) || 0;
            const troco = parseFloat(document.getElementById('troco').value) || 0;
            const dinheiroRetido = parseFloat(document.getElementById('dinheiroRetido').value) || 0;
            const observacoes = document.getElementById('observacoes').value.trim();

            const motoboyNome = novoMotoboy || motoboySelect;

            if (!motoboyNome || !data || !numeroPedido || !nomeRota) {
                alert('‚ùå Preencha pelo menos: Motoboy, Data, Nome da Rota e N¬∫ Pedido!');
                return;
            }

            const valorFinal = valorRota - desconto - troco - dinheiroRetido;

            const pedido = {
                id: contador++,
                data,
                nomeRota,
                numeroPedido,
                motoboy: motoboyNome,
                telefone,
                dinheiroRecebido,
                valorRota,
                desconto,
                troco,
                dinheiroRetido,
                valorFinal,
                observacoes,
                timestamp: new Date()
            };

            pedidos.push(pedido);
            
            // Atualizar dados do motoboy
            motoboysData[motoboyNome] = {
                telefone: telefone,
                ultimoPedido: data
            };

            // Adicionar nova rota ao conjunto de rotas dispon√≠veis
            if (nomeRota) {
                rotasDisponiveis.add(nomeRota);
            }

            atualizarTabelaPedidos();
            atualizarStats();
            atualizarSelects();
            limparFormulario();

            alert(`‚úÖ Pedido ${numeroPedido} de ${motoboyNome} na ${nomeRota} adicionado!`);
        }

        function atualizarTabelaPedidos() {
            const tbody = document.getElementById('tabelaPedidos');
            tbody.innerHTML = '';

            const pedidosFiltrados = filtrarPedidos();

            if (pedidosFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="12" style="text-align: center; color: #7f8c8d; padding: 40px;">
                            Nenhum pedido encontrado para os filtros aplicados.
                        </td>
                    </tr>
                `;
                return;
            }

            pedidosFiltrados.slice().reverse().forEach(pedido => {
                const tr = document.createElement('tr');
                
                const valorFinalColor = pedido.valorFinal > 0 ? '#27ae60' : 
                                      pedido.valorFinal < 0 ? '#e74c3c' : '#3498db';

                const corRota = obterCorRota(pedido.nomeRota);

                tr.innerHTML = `
                    <td>${formatarData(pedido.data)}</td>
                    <td>
                        <strong>${pedido.nomeRota}</strong>
                        ${corRota ? `<span class="rota-badge ${corRota}"></span>` : ''}
                    </td>
                    <td><strong>${pedido.numeroPedido}</strong></td>
                    <td><strong>${pedido.motoboy}</strong></td>
                    <td>R$ ${pedido.dinheiroRecebido.toFixed(2)}</td>
                    <td>R$ ${pedido.valorRota.toFixed(2)}</td>
                    <td>R$ ${pedido.desconto.toFixed(2)}</td>
                    <td>R$ ${pedido.troco.toFixed(2)}</td>
                    <td>R$ ${pedido.dinheiroRetido.toFixed(2)}</td>
                    <td><strong style="color: ${valorFinalColor}">R$ ${pedido.valorFinal.toFixed(2)}</strong></td>
                    <td title="${pedido.observacoes}" style="max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                        ${pedido.observacoes || '-'}
                    </td>
                    <td>
                        <button class="btn btn-danger btn-small" onclick="removerPedido(${pedido.id})" title="Remover">
                            üóëÔ∏è
                        </button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        function atualizarTabelaMotoboys() {
            const tbody = document.getElementById('tabelaMotoboys');
            tbody.innerHTML = '';

            const motoboysNomes = Object.keys(motoboysData);

            if (motoboysNomes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; color: #7f8c8d; padding: 40px;">
                            Nenhum motoboy cadastrado ainda.
                        </td>
                    </tr>
                `;
                return;
            }

            motoboysNomes.forEach(nome => {
                const dadosMotoboy = motoboysData[nome];
                const pedidosMotoboy = pedidos.filter(p => p.motoboy === nome);
                const totalPedidos = pedidosMotoboy.length;
                const ultimoPedido = dadosMotoboy.ultimoPedido;

                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${nome}</strong></td>
                    <td>${dadosMotoboy.telefone || '-'}</td>
                    <td>${totalPedidos}</td>
                    <td>${ultimoPedido ? formatarData(ultimoPedido) : '-'}</td>
                    <td>
                        <button class="btn btn-info btn-small" onclick="abrirModalEditarMotoboy('${nome}')" title="Editar">
                            ‚úèÔ∏è Editar
                        </button>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        function filtrarPedidos() {
            const motoboyFiltro = document.getElementById('filtroMotoboy').value;
            const rotaFiltro = document.getElementById('filtroRota').value;
            const dataFiltro = document.getElementById('filtroData').value;
            
            return pedidos.filter(pedido => {
                const motoboyMatch = !motoboyFiltro || pedido.motoboy === motoboyFiltro;
                const rotaMatch = !rotaFiltro || pedido.nomeRota === rotaFiltro;
                const dataMatch = !dataFiltro || pedido.data === dataFiltro;
                return motoboyMatch && rotaMatch && dataMatch;
            });
        }

        function filtrarTabela() {
            atualizarTabelaPedidos();
        }

        function atualizarStats() {
            const hoje = new Date().toISOString().split('T')[0];
            const pedidosHoje = pedidos.filter(p => p.data === hoje);
            
            document.getElementById('totalPedidos').textContent = pedidos.length;
            document.getElementById('totalPedidosHoje').textContent = pedidosHoje.length;
            document.getElementById('totalValorRota').textContent = `R$ ${pedidos.reduce((sum, p) => sum + p.valorRota, 0).toFixed(2)}`;
            document.getElementById('totalValorFinal').textContent = `R$ ${pedidos.filter(p => p.valorFinal > 0).reduce((sum, p) => sum + p.valorFinal, 0).toFixed(2)}`;
        }

        function atualizarSelects() {
            const motoboysNomes = Object.keys(motoboysData);
            const rotasArray = Array.from(rotasDisponiveis);
            
            // Select de motoboys no formul√°rio
            const selectMotoboy = document.getElementById('motoboy');
            selectMotoboy.innerHTML = '<option value="">Selecione ou cadastre novo</option>' + 
                motoboysNomes.map(nome => `<option value="${nome}">${nome}</option>`).join('');

            // Select de filtro na tabela
            const filtroMotoboy = document.getElementById('filtroMotoboy');
            filtroMotoboy.innerHTML = '<option value="">Todos os motoboys</option>' + 
                motoboysNomes.map(nome => `<option value="${nome}">${nome}</option>`).join('');

            const filtroRota = document.getElementById('filtroRota');
            filtroRota.innerHTML = '<option value="">Todas as rotas</option>' + 
                rotasArray.map(rota => `<option value="${rota}">${rota}</option>`).join('');

            // Select de filtro nas rotas
            const filtroRotaTipo = document.getElementById('filtroRotaTipo');
            filtroRotaTipo.innerHTML = '<option value="">Todas as rotas</option>' + 
                rotasArray.map(rota => `<option value="${rota}">${rota}</option>`).join('');

            // Select de relat√≥rio
            const motoboyRelatorio = document.getElementById('motoboyRelatorio');
            motoboyRelatorio.innerHTML = '<option value="">Todos os motoboys</option>' + 
                motoboysNomes.map(nome => `<option value="${nome}">${nome}</option>`).join('');

            const rotaRelatorio = document.getElementById('rotaRelatorio');
            rotaRelatorio.innerHTML = '<option value="">Todas as rotas</option>' + 
                rotasArray.map(rota => `<option value="${rota}">${rota}</option>`).join('');
        }

        // MODAL EDITAR MOTOBOY
        function abrirModalEditarMotoboy(nome) {
            motoboyEditando = nome;
            document.getElementById('editNomeMotoboy').value = nome;
            document.getElementById('editTelefoneMotoboy').value = motoboysData[nome].telefone || '';
            document.getElementById('modalEditarMotoboy').style.display = 'block';
        }

        function fecharModal() {
            document.getElementById('modalEditarMotoboy').style.display = 'none';
            motoboyEditando = '';
        }

        function salvarEdicaoMotoboy() {
            const novoTelefone = document.getElementById('editTelefoneMotoboy').value.trim();
            
            if (!novoTelefone) {
                alert('‚ùå Informe o telefone do motoboy!');
                return;
            }

            // Atualizar dados do motoboy
            motoboysData[motoboyEditando].telefone = novoTelefone;
            
            // Atualizar telefone em todos os pedidos deste motoboy
            pedidos.forEach(pedido => {
                if (pedido.motoboy === motoboyEditando) {
                    pedido.telefone = novoTelefone;
                }
            });

            atualizarTabelaMotoboys();
            atualizarTabelaPedidos();
            fecharModal();
            
            alert(`‚úÖ Telefone de ${motoboyEditando} atualizado com sucesso!`);
        }

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('modalEditarMotoboy');
            if (event.target === modal) {
                fecharModal();
            }
        }

        function removerPedido(id) {
            if (confirm('Tem certeza que deseja remover este pedido?')) {
                pedidos = pedidos.filter(p => p.id !== id);
                atualizarTabelaPedidos();
                atualizarStats();
                
                // Atualizar dados dos motoboys
                const motoboysComPedidos = [...new Set(pedidos.map(p => p.motoboy))];
                const motoboysParaRemover = Object.keys(motoboysData).filter(nome => !motoboysComPedidos.includes(nome));
                
                motoboysParaRemover.forEach(nome => {
                    delete motoboysData[nome];
                });
                
                // Atualizar √∫ltima data dos motoboys restantes
                motoboysComPedidos.forEach(nome => {
                    const pedidosMotoboy = pedidos.filter(p => p.motoboy === nome);
                    if (pedidosMotoboy.length > 0) {
                        const ultimaData = pedidosMotoboy.sort((a, b) => new Date(b.data) - new Date(a.data))[0].data;
                        motoboysData[nome].ultimoPedido = ultimaData;
                    }
                });

                // Atualizar rotas dispon√≠veis
                rotasDisponiveis.clear();
                pedidos.forEach(p => rotasDisponiveis.add(p.nomeRota));

                atualizarSelects();
            }
        }

        function limparFormulario() {
            ['motoboy', 'novoMotoboy', 'telefone', 'nomeRota', 'numeroPedido', 'dinheiroRecebido', 'valorRota', 'desconto', 'troco', 'dinheiroRetido', 'observacoes'].forEach(id => {
                document.getElementById(id).value = '';
            });
            document.getElementById('data').value = new Date().toISOString().split('T')[0];
            document.getElementById('previewCalculo').innerHTML = 'üí° F√≥rmula: Valor da Rota - Desconto - Troco - Dinheiro Retido';
        }

        function limparTudo() {
            if (confirm('‚ö†Ô∏è Tem certeza que deseja limpar todos os dados? Esta a√ß√£o n√£o pode ser desfeita!')) {
                pedidos = [];
                motoboysData = {};
                rotasDisponiveis.clear();
                contador = 1;
                atualizarTabelaPedidos();
                atualizarTabelaMotoboys();
                atualizarStats();
                atualizarSelects();
                limparFormulario();
                alert('‚úÖ Todos os dados foram removidos!');
            }
        }

        // ROTAS AGRUPADAS
        function atualizarRotas() {
            const dataFiltro = document.getElementById('filtroDataRota').value;
            const rotaTipoFiltro = document.getElementById('filtroRotaTipo').value;
            const container = document.getElementById('rotasContainer');
            container.innerHTML = '';

            let pedidosDoDia = pedidos.filter(p => p.data === dataFiltro);
            if (rotaTipoFiltro) {
                pedidosDoDia = pedidosDoDia.filter(p => p.nomeRota === rotaTipoFiltro);
            }

            // Agrupar por motoboy e tipo de rota
            const gruposRota = {};
            pedidosDoDia.forEach(pedido => {
                const chave = `${pedido.motoboy}_${pedido.nomeRota}`;
                if (!gruposRota[chave]) {
                    gruposRota[chave] = {
                        motoboy: pedido.motoboy,
                        nomeRota: pedido.nomeRota,
                        telefone: pedido.telefone,
                        pedidos: []
                    };
                }
                gruposRota[chave].pedidos.push(pedido);
            });

            const grupos = Object.values(gruposRota);

            if (grupos.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 40px;">Nenhuma rota encontrada para esta data e filtros.</div>';
                return;
            }

            grupos.forEach(grupo => {
                const totalPedidos = grupo.pedidos.length;
                const totalDinheiroRecebido = grupo.pedidos.reduce((sum, p) => sum + p.dinheiroRecebido, 0);
                const totalValorRota = grupo.pedidos.reduce((sum, p) => sum + p.valorRota, 0);
                const totalDescontos = grupo.pedidos.reduce((sum, p) => sum + p.desconto, 0);
                const totalTrocos = grupo.pedidos.reduce((sum, p) => sum + p.troco, 0);
                const totalRetido = grupo.pedidos.reduce((sum, p) => sum + p.dinheiroRetido, 0);
                const totalValorFinal = grupo.pedidos.reduce((sum, p) => sum + p.valorFinal, 0);
                
                const statusColor = totalValorFinal > 0 ? '#27ae60' : 
                                  totalValorFinal < 0 ? '#e74c3c' : '#3498db';
                const statusText = totalValorFinal > 0 ? 'RECEBER' : 
                                 totalValorFinal < 0 ? 'NEGATIVO' : 'ZERADO';

                const corRota = obterCorRota(grupo.nomeRota);

                const card = document.createElement('div');
                card.className = 'rota-card';
                card.innerHTML = `
                    <div class="rota-header">
                        <div class="rota-name">
                            üë§ ${grupo.motoboy}
                            <span class="rota-badge ${corRota}">${grupo.nomeRota}</span>
                        </div>
                        <div style="background: ${statusColor}; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.8em; font-weight: bold;">
                            ${statusText}
                        </div>
                    </div>
                    
                    <div style="font-size: 0.9em; color: #7f8c8d; margin-bottom: 15px;">
                        üìÖ ${formatarData(dataFiltro)} | üìû ${grupo.telefone} | üì¶ ${totalPedidos} pedidos
                    </div>
                    
                    <div class="rota-totals">
                        <div class="total-row">
                            <span>üíµ Total Dinheiro Recebido:</span>
                            <span>R$ ${totalDinheiroRecebido.toFixed(2)}</span>
                        </div>
                        <div class="total-row">
                            <span>üí∞ Total Valor das Rotas:</span>
                            <span>R$ ${totalValorRota.toFixed(2)}</span>
                        </div>
                        <div class="total-row">
                            <span>üí≥ (-) Total Descontos:</span>
                            <span>R$ ${totalDescontos.toFixed(2)}</span>
                        </div>
                        <div class="total-row">
                            <span>üîÑ (-) Total Trocos:</span>
                            <span>R$ ${totalTrocos.toFixed(2)}</span>
                        </div>
                        <div class="total-row">
                            <span>üè™ (-) Total Retido:</span>
                            <span>R$ ${totalRetido.toFixed(2)}</span>
                        </div>
                        <div class="total-row final">
                            <span>${totalValorFinal > 0 ? 'VALOR FINAL A RECEBER:' : totalValorFinal < 0 ? 'VALOR NEGATIVO:' : 'SITUA√á√ÉO:'}</span>
                            <span style="color: ${statusColor}">
                                R$ ${Math.abs(totalValorFinal).toFixed(2)}
                            </span>
                        </div>
                    </div>

                    <div class="pedidos-list">
                        <div style="font-weight: bold; margin-bottom: 10px; color: #2c3e50;">üìã Pedidos da Rota:</div>
                        ${grupo.pedidos.map(p => `
                            <div class="pedido-item">
                                <span><strong>${p.numeroPedido}</strong> ${p.observacoes ? 'üìù' : ''}</span>
                                <span>R$ ${p.valorFinal.toFixed(2)}</span>
                            </div>
                        `).join('')}
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn btn-success" onclick="copiarCardRota('${grupo.motoboy}', '${grupo.nomeRota}', '${dataFiltro}')" style="flex: 1;">
                            üìã Copiar Card
                        </button>
                        <button class="btn btn-warning" onclick="enviarWhatsAppRota('${grupo.telefone}', '${grupo.motoboy}', '${grupo.nomeRota}', '${dataFiltro}')" style="flex: 1;">
                            üì± WhatsApp
                        </button>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        function copiarCardRota(motoboyNome, nomeRota, data) {
            const pedidosDaRota = pedidos.filter(p => p.data === data && p.motoboy === motoboyNome && p.nomeRota === nomeRota);
            const telefone = pedidosDaRota[0]?.telefone || '';
            
            const totalPedidos = pedidosDaRota.length;
            const totalDinheiroRecebido = pedidosDaRota.reduce((sum, p) => sum + p.dinheiroRecebido, 0);
            const totalValorRota = pedidosDaRota.reduce((sum, p) => sum + p.valorRota, 0);
            const totalDescontos = pedidosDaRota.reduce((sum, p) => sum + p.desconto, 0);
            const totalTrocos = pedidosDaRota.reduce((sum, p) => sum + p.troco, 0);
            const totalRetido = pedidosDaRota.reduce((sum, p) => sum + p.dinheiroRetido, 0);
            const totalValorFinal = pedidosDaRota.reduce((sum, p) => sum + p.valorFinal, 0);

            const texto = `üèçÔ∏è *PRESTA√á√ÉO DE CONTAS DI√ÅRIA*
üìÖ Data: ${formatarData(data)}
üë§ Motoboy: *${motoboyNome}*
üõ£Ô∏è Rota: *${nomeRota}*
üìû Telefone: ${telefone}

üìä *RESUMO DA ROTA:*
üì¶ Total de Pedidos: ${totalPedidos}
üíµ Dinheiro Recebido: R$ ${totalDinheiroRecebido.toFixed(2)}
üí∞ Valor das Rotas: R$ ${totalValorRota.toFixed(2)}

üí∏ *DESCONTOS:*
üí≥ Descontos: R$ ${totalDescontos.toFixed(2)}
üîÑ Trocos: R$ ${totalTrocos.toFixed(2)}
üè™ Dinheiro Retido: R$ ${totalRetido.toFixed(2)}

${totalValorFinal > 0 ? `üíµ *VALOR FINAL A RECEBER: R$ ${totalValorFinal.toFixed(2)}*` : 
  totalValorFinal < 0 ? `üî¥ *VALOR NEGATIVO: R$ ${Math.abs(totalValorFinal).toFixed(2)}*` : 
  `‚úÖ *CONTAS ZERADAS*`}

üìã *PEDIDOS DA ROTA:*
${pedidosDaRota.map(p => `‚Ä¢ ${p.numeroPedido}: R$ ${p.valorFinal.toFixed(2)}${p.observacoes ? ` (${p.observacoes})` : ''}`).join('\n')}

_Cal√ßados 24h - Sistema de Gest√£o - ${new Date().toLocaleDateString('pt-BR')}_`;

            navigator.clipboard.writeText(texto).then(() => {
                alert(`Card de ${motoboyNome} - ${nomeRota} copiado para a √°rea de transfer√™ncia!`);
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = texto;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert(`Card de ${motoboyNome} - ${nomeRota} copiado para a √°rea de transfer√™ncia!`);
            });
        }

        function enviarWhatsAppRota(telefone, motoboyNome, nomeRota, data) {
            const pedidosDaRota = pedidos.filter(p => p.data === data && p.motoboy === motoboyNome && p.nomeRota === nomeRota);
            
            const totalPedidos = pedidosDaRota.length;
            const totalDinheiroRecebido = pedidosDaRota.reduce((sum, p) => sum + p.dinheiroRecebido, 0);
            const totalValorRota = pedidosDaRota.reduce((sum, p) => sum + p.valorRota, 0);
            const totalDescontos = pedidosDaRota.reduce((sum, p) => sum + p.desconto, 0);
            const totalTrocos = pedidosDaRota.reduce((sum, p) => sum + p.troco, 0);
            const totalRetido = pedidosDaRota.reduce((sum, p) => sum + p.dinheiroRetido, 0);
            const totalValorFinal = pedidosDaRota.reduce((sum, p) => sum + p.valorFinal, 0);

            const texto = `üèçÔ∏è *PRESTA√á√ÉO DE CONTAS DI√ÅRIA*
üìÖ Data: ${formatarData(data)}
üë§ Motoboy: *${motoboyNome}*
üõ£Ô∏è Rota: *${nomeRota}*

üìä *RESUMO DA ROTA:*
üì¶ Total de Pedidos: ${totalPedidos}
üíµ Dinheiro Recebido: R$ ${totalDinheiroRecebido.toFixed(2)}
üí∞ Valor das Rotas: R$ ${totalValorRota.toFixed(2)}

üí∏ *DESCONTOS:*
üí≥ Descontos: R$ ${totalDescontos.toFixed(2)}
üîÑ Trocos: R$ ${totalTrocos.toFixed(2)}
üè™ Dinheiro Retido: R$ ${totalRetido.toFixed(2)}

${totalValorFinal > 0 ? `üíµ *VALOR FINAL A RECEBER: R$ ${totalValorFinal.toFixed(2)}*` : 
  totalValorFinal < 0 ? `üî¥ *VALOR NEGATIVO: R$ ${Math.abs(totalValorFinal).toFixed(2)}*` : 
  `‚úÖ *CONTAS ZERADAS*`}

üìã *PEDIDOS DA ROTA:*
${pedidosDaRota.map(p => `‚Ä¢ ${p.numeroPedido}: R$ ${p.valorFinal.toFixed(2)}${p.observacoes ? ` (${p.observacoes})` : ''}`).join('\n')}

_Cal√ßados 24h - Controle de Presta√ß√£o de Contas_`;

            const numeroLimpo = telefone.replace(/\D/g, '');
            const url = `https://wa.me/55${numeroLimpo}?text=${encodeURIComponent(texto)}`;
            window.open(url, '_blank');
        }

        function copiarResumoRotas() {
            const dataFiltro = document.getElementById('filtroDataRota').value;
            const rotaTipoFiltro = document.getElementById('filtroRotaTipo').value;
            
            let pedidosDoDia = pedidos.filter(p => p.data === dataFiltro);
            if (rotaTipoFiltro) {
                pedidosDoDia = pedidosDoDia.filter(p => p.nomeRota === rotaTipoFiltro);
            }

            // Agrupar por motoboy e tipo de rota
            const gruposRota = {};
            pedidosDoDia.forEach(pedido => {
                const chave = `${pedido.motoboy}_${pedido.nomeRota}`;
                if (!gruposRota[chave]) {
                    gruposRota[chave] = {
                        motoboy: pedido.motoboy,
                        nomeRota: pedido.nomeRota,
                        pedidos: []
                    };
                }
                gruposRota[chave].pedidos.push(pedido);
            });

            const grupos = Object.values(gruposRota);
            
            if (grupos.length === 0) {
                alert('Nenhuma rota encontrada para esta data e filtros.');
                return;
            }
            
            let textoCompleto = `üìã *RESUMO GERAL DAS ROTAS - ${formatarData(dataFiltro)}*
_Cal√ßados 24h_
${rotaTipoFiltro ? `Filtro: ${rotaTipoFiltro}` : ''}

`;
            
            grupos.forEach(grupo => {
                const totalPedidos = grupo.pedidos.length;
                const totalValorFinal = grupo.pedidos.reduce((sum, p) => sum + p.valorFinal, 0);
                
                textoCompleto += `üë§ *${grupo.motoboy}* - üõ£Ô∏è ${grupo.nomeRota}
üì¶ Pedidos: ${totalPedidos}
üíµ ${totalValorFinal > 0 ? 'Valor Final a Receber' : totalValorFinal < 0 ? 'Valor Negativo' : 'Zerado'}: R$ ${Math.abs(totalValorFinal).toFixed(2)}

`;
            });
            
            navigator.clipboard.writeText(textoCompleto).then(() => {
                alert('Resumo de todas as rotas copiado!');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = textoCompleto;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Resumo de todas as rotas copiado!');
            });
        }

        function enviarWhatsAppRotas() {
            alert('Esta funcionalidade enviaria o resumo para todos os motoboys via WhatsApp. Implementa√ß√£o espec√≠fica conforme necessidade.');
        }

        // RELAT√ìRIOS DETALHADOS
        function gerarRelatorioDetalhado() {
            const tipo = document.getElementById('tipoRelatorio').value;
            const dataInicio = document.getElementById('dataRelatorio').value;
            const dataFim = document.getElementById('dataRelatorioFim').value;
            const motoboyFiltro = document.getElementById('motoboyRelatorio').value;
            const rotaFiltro = document.getElementById('rotaRelatorio').value;
            
            let pedidosFiltrados = [];
            let titulo = '';
            
            if (tipo === 'diario') {
                pedidosFiltrados = pedidos.filter(p => p.data === dataInicio);
                titulo = `RELAT√ìRIO DI√ÅRIO - ${formatarData(dataInicio)}`;
            } else if (tipo === 'intervalo') {
                if (!dataInicio || !dataFim) {
                    alert('‚ùå Selecione as datas de in√≠cio e fim para o relat√≥rio por intervalo!');
                    return;
                }
                pedidosFiltrados = pedidos.filter(p => {
                    return p.data >= dataInicio && p.data <= dataFim;
                });
                titulo = `RELAT√ìRIO POR INTERVALO - ${formatarData(dataInicio)} a ${formatarData(dataFim)}`;
            } else if (tipo === 'semanal') {
                const dataObj = new Date(dataInicio);
                const inicioSemana = new Date(dataObj);
                inicioSemana.setDate(dataObj.getDate() - dataObj.getDay());
                const fimSemana = new Date(inicioSemana);
                fimSemana.setDate(inicioSemana.getDate() + 6);
                
                pedidosFiltrados = pedidos.filter(p => {
                    const pedidoData = new Date(p.data);
                    return pedidoData >= inicioSemana && pedidoData <= fimSemana;
                });
                titulo = `RELAT√ìRIO SEMANAL - ${formatarData(inicioSemana.toISOString().split('T')[0])} a ${formatarData(fimSemana.toISOString().split('T')[0])}`;
            } else if (tipo === 'mensal') {
                const dataObj = new Date(dataInicio);
                const ano = dataObj.getFullYear();
                const mes = dataObj.getMonth();
                
                pedidosFiltrados = pedidos.filter(p => {
                    const pedidoData = new Date(p.data);
                    return pedidoData.getFullYear() === ano && pedidoData.getMonth() === mes;
                });
                titulo = `RELAT√ìRIO MENSAL - ${mes + 1}/${ano}`;
            } else if (tipo === 'motoboy') {
                if (!motoboyFiltro) {
                    alert('Selecione um motoboy para o relat√≥rio individual!');
                    return;
                }
                pedidosFiltrados = pedidos.filter(p => p.motoboy === motoboyFiltro);
                titulo = `RELAT√ìRIO POR MOTOBOY - ${motoboyFiltro}`;
            } else if (tipo === 'rota') {
                if (!rotaFiltro) {
                    alert('Selecione um tipo de rota para o relat√≥rio!');
                    return;
                }
                pedidosFiltrados = pedidos.filter(p => p.nomeRota === rotaFiltro);
                titulo = `RELAT√ìRIO POR TIPO DE ROTA - ${rotaFiltro}`;
            }
            
            if (motoboyFiltro && tipo !== 'motoboy') {
                pedidosFiltrados = pedidosFiltrados.filter(p => p.motoboy === motoboyFiltro);
                titulo += ` - ${motoboyFiltro}`;
            }

            if (rotaFiltro && tipo !== 'rota') {
                pedidosFiltrados = pedidosFiltrados.filter(p => p.nomeRota === rotaFiltro);
                titulo += ` - ${rotaFiltro}`;
            }
            
            gerarTextoRelatorio(pedidosFiltrados, titulo);
        }

        function gerarTextoRelatorio(pedidosFiltrados, titulo) {
            if (pedidosFiltrados.length === 0) {
                alert('Nenhum pedido encontrado para os filtros selecionados!');
                return;
            }

            let relatorio = `${titulo}
Cal√ßados 24h - Controle de Presta√ß√£o de Contas - Motoboys
Gerado em: ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}

`;
            
            // Resumo geral
            const totalPedidos = pedidosFiltrados.length;
            const totalDinheiroRecebido = pedidosFiltrados.reduce((sum, p) => sum + p.dinheiroRecebido, 0);
            const totalValorRota = pedidosFiltrados.reduce((sum, p) => sum + p.valorRota, 0);
            const totalDescontos = pedidosFiltrados.reduce((sum, p) => sum + p.desconto, 0);
            const totalTrocos = pedidosFiltrados.reduce((sum, p) => sum + p.troco, 0);
            const totalRetido = pedidosFiltrados.reduce((sum, p) => sum + p.dinheiroRetido, 0);
            const totalValorFinal = pedidosFiltrados.reduce((sum, p) => sum + p.valorFinal, 0);
            
            relatorio += `üìä RESUMO GERAL:
Total de Pedidos: ${totalPedidos}
Total Dinheiro Recebido: R$ ${totalDinheiroRecebido.toFixed(2)}
Total Valor das Rotas: R$ ${totalValorRota.toFixed(2)}
Total Descontos: R$ ${totalDescontos.toFixed(2)}
Total Trocos: R$ ${totalTrocos.toFixed(2)}
Total Dinheiro Retido: R$ ${totalRetido.toFixed(2)}
Total Valor Final: R$ ${totalValorFinal.toFixed(2)}

`;

            // Agrupamento por motoboy, rota e data
            const gruposCompletos = {};
            pedidosFiltrados.forEach(pedido => {
                const chave = `${pedido.motoboy}_${pedido.nomeRota}_${pedido.data}`;
                if (!gruposCompletos[chave]) {
                    gruposCompletos[chave] = {
                        motoboy: pedido.motoboy,
                        nomeRota: pedido.nomeRota,
                        data: pedido.data,
                        telefone: pedido.telefone,
                        pedidos: []
                    };
                }
                gruposCompletos[chave].pedidos.push(pedido);
            });

            relatorio += `üë• DETALHAMENTO POR MOTOBOY, ROTA E DATA:

`;

            Object.values(gruposCompletos).forEach(grupo => {
                const totalPedidosGrupo = grupo.pedidos.length;
                const totalDinheiroRecebidoGrupo = grupo.pedidos.reduce((sum, p) => sum + p.dinheiroRecebido, 0);
                const totalValorRotaGrupo = grupo.pedidos.reduce((sum, p) => sum + p.valorRota, 0);
                const totalDescontosGrupo = grupo.pedidos.reduce((sum, p) => sum + p.desconto, 0);
                const totalTrocosGrupo = grupo.pedidos.reduce((sum, p) => sum + p.troco, 0);
                const totalRetidoGrupo = grupo.pedidos.reduce((sum, p) => sum + p.dinheiroRetido, 0);
                const totalValorFinalGrupo = grupo.pedidos.reduce((sum, p) => sum + p.valorFinal, 0);

                relatorio += `üèçÔ∏è ${grupo.motoboy} - üõ£Ô∏è ${grupo.nomeRota} - ${formatarData(grupo.data)}
üìû Telefone: ${grupo.telefone}
üì¶ Pedidos: ${totalPedidosGrupo}
üíµ Dinheiro Recebido: R$ ${totalDinheiroRecebidoGrupo.toFixed(2)}
üí∞ Valor das Rotas: R$ ${totalValorRotaGrupo.toFixed(2)}
üí≥ Descontos: R$ ${totalDescontosGrupo.toFixed(2)}
üîÑ Trocos: R$ ${totalTrocosGrupo.toFixed(2)}
üè™ Dinheiro Retido: R$ ${totalRetidoGrupo.toFixed(2)}
üí∏ Valor Final: R$ ${totalValorFinalGrupo.toFixed(2)}

üìã PEDIDOS INDIVIDUAIS:
${grupo.pedidos.map(p => `  ‚Ä¢ ${p.numeroPedido}: Din.Rec. R$ ${p.dinheiroRecebido.toFixed(2)} | Val.Rota R$ ${p.valorRota.toFixed(2)} | Final R$ ${p.valorFinal.toFixed(2)}${p.observacoes ? ` | Obs: ${p.observacoes}` : ''}`).join('\n')}

`;
            });
            
            document.getElementById('relatorioTitulo').textContent = titulo;
            document.getElementById('relatorioTexto').textContent = relatorio;
            document.getElementById('relatorioContent').style.display = 'block';
        }

        function copiarRelatorio() {
            const conteudo = document.getElementById('relatorioTexto').textContent;
            navigator.clipboard.writeText(conteudo).then(() => {
                alert('Relat√≥rio copiado para a √°rea de transfer√™ncia!');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = conteudo;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Relat√≥rio copiado para a √°rea de transfer√™ncia!');
            });
        }

        // EXPORTAR EXCEL
        function gerarExcel() {
            if (pedidos.length === 0) {
                alert('‚ùå N√£o h√° dados para exportar!');
                return;
            }

            // Preparar dados para Excel - Planilha de Pedidos Individuais
            const dadosPedidos = pedidos.map(pedido => ({
                'Data': formatarData(pedido.data),
                'Nome da Rota': pedido.nomeRota,
                'N¬∫ Pedido': pedido.numeroPedido,
                'Motoboy': pedido.motoboy,
                'Telefone': pedido.telefone,
                'Dinheiro Recebido (R$)': pedido.dinheiroRecebido.toFixed(2),
                'Valor da Rota (R$)': pedido.valorRota.toFixed(2),
                'Desconto (R$)': pedido.desconto.toFixed(2),
                'Troco (R$)': pedido.troco.toFixed(2),
                'Dinheiro Retido (R$)': pedido.dinheiroRetido.toFixed(2),
                'Valor Final (R$)': pedido.valorFinal.toFixed(2),
                'Observa√ß√µes': pedido.observacoes || ''
            }));

            // Preparar dados para Excel - Resumo por Rota/Data
            const resumoRotas = [];
            const gruposCompletos = {};
            
            pedidos.forEach(pedido => {
                const chave = `${pedido.motoboy}_${pedido.nomeRota}_${pedido.data}`;
                if (!gruposCompletos[chave]) {
                    gruposCompletos[chave] = {
                        motoboy: pedido.motoboy,
                        nomeRota: pedido.nomeRota,
                        data: pedido.data,
                        telefone: pedido.telefone,
                        pedidos: []
                    };
                }
                gruposCompletos[chave].pedidos.push(pedido);
            });

            Object.values(gruposCompletos).forEach(grupo => {
                const totalPedidos = grupo.pedidos.length;
                const totalDinheiroRecebido = grupo.pedidos.reduce((sum, p) => sum + p.dinheiroRecebido, 0);
                const totalValorRota = grupo.pedidos.reduce((sum, p) => sum + p.valorRota, 0);
                const totalDescontos = grupo.pedidos.reduce((sum, p) => sum + p.desconto, 0);
                const totalTrocos = grupo.pedidos.reduce((sum, p) => sum + p.troco, 0);
                const totalRetido = grupo.pedidos.reduce((sum, p) => sum + p.dinheiroRetido, 0);
                const totalValorFinal = grupo.pedidos.reduce((sum, p) => sum + p.valorFinal, 0);
                
                resumoRotas.push({
                    'Data': formatarData(grupo.data),
                    'Motoboy': grupo.motoboy,
                    'Nome da Rota': grupo.nomeRota,
                    'Telefone': grupo.telefone,
                    'Qtd Pedidos': totalPedidos,
                    'Total Dinheiro Recebido (R$)': totalDinheiroRecebido.toFixed(2),
                    'Total Valor Rotas (R$)': totalValorRota.toFixed(2),
                    'Total Descontos (R$)': totalDescontos.toFixed(2),
                    'Total Trocos (R$)': totalTrocos.toFixed(2),
                    'Total Retido (R$)': totalRetido.toFixed(2),
                    'Total Valor Final (R$)': totalValorFinal.toFixed(2),
                    'Lista Pedidos': grupo.pedidos.map(p => p.numeroPedido).join(', '),
                    'Observa√ß√µes Gerais': grupo.pedidos.filter(p => p.observacoes).map(p => `${p.numeroPedido}: ${p.observacoes}`).join('; ')
                });
            });

            // Preparar dados para Excel - Planilha de Motoboys
            const dadosMotoboys = Object.keys(motoboysData).map(nome => {
                const dados = motoboysData[nome];
                const pedidosMotoboy = pedidos.filter(p => p.motoboy === nome);
                const totalPedidos = pedidosMotoboy.length;
                const totalValorFinal = pedidosMotoboy.reduce((sum, p) => sum + p.valorFinal, 0);
                
                return {
                    'Nome': nome,
                    'Telefone': dados.telefone || '',
                    'Total Pedidos': totalPedidos,
                    '√öltimo Pedido': dados.ultimoPedido ? formatarData(dados.ultimoPedido) : '',
                    'Total Valor Final (R$)': totalValorFinal.toFixed(2)
                };
            });

            // Preparar dados para Excel - Resumo por Tipo de Rota
            const resumoPorTipoRota = [];
            const rotasEstatisticas = {};
            
            pedidos.forEach(pedido => {
                if (!rotasEstatisticas[pedido.nomeRota]) {
                    rotasEstatisticas[pedido.nomeRota] = {
                        totalPedidos: 0,
                        totalValorRota: 0,
                        totalValorFinal: 0,
                        motoboys: new Set()
                    };
                }
                rotasEstatisticas[pedido.nomeRota].totalPedidos++;
                rotasEstatisticas[pedido.nomeRota].totalValorRota += pedido.valorRota;
                rotasEstatisticas[pedido.nomeRota].totalValorFinal += pedido.valorFinal;
                rotasEstatisticas[pedido.nomeRota].motoboys.add(pedido.motoboy);
            });

            Object.keys(rotasEstatisticas).forEach(nomeRota => {
                const stats = rotasEstatisticas[nomeRota];
                resumoPorTipoRota.push({
                    'Nome da Rota': nomeRota,
                    'Total Pedidos': stats.totalPedidos,
                    'Total Motoboys': stats.motoboys.size,
                    'Total Valor Rotas (R$)': stats.totalValorRota.toFixed(2),
                    'Total Valor Final (R$)': stats.totalValorFinal.toFixed(2),
                    'M√©dia por Pedido (R$)': (stats.totalValorRota / stats.totalPedidos).toFixed(2)
                });
            });

            // Criar workbook
            const wb = XLSX.utils.book_new();
            
            // Planilha 1: Pedidos Individuais
            const ws1 = XLSX.utils.json_to_sheet(dadosPedidos);
            XLSX.utils.book_append_sheet(wb, ws1, "Pedidos Individuais");
            
            // Planilha 2: Resumo por Rotas
            const ws2 = XLSX.utils.json_to_sheet(resumoRotas);
            XLSX.utils.book_append_sheet(wb, ws2, "Resumo por Rotas");

            // Planilha 3: Dados dos Motoboys
            const ws3 = XLSX.utils.json_to_sheet(dadosMotoboys);
            XLSX.utils.book_append_sheet(wb, ws3, "Motoboys");

            // Planilha 4: Estat√≠sticas por Tipo de Rota
            const ws4 = XLSX.utils.json_to_sheet(resumoPorTipoRota);
            XLSX.utils.book_append_sheet(wb, ws4, "Estat√≠sticas por Rota");

            // Salvar arquivo
            const nomeArquivo = `Calcados24h_Prestacao_Contas_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, nomeArquivo);
            
            alert(`‚úÖ Planilha Excel gerada com sucesso!\nArquivo: ${nomeArquivo}\n\nüìä Cont√©m quatro abas:\n‚Ä¢ Pedidos Individuais (${dadosPedidos.length} pedidos)\n‚Ä¢ Resumo por Rotas (${resumoRotas.length} grupos)\n‚Ä¢ Motoboys (${dadosMotoboys.length} motoboys)\n‚Ä¢ Estat√≠sticas por Rota (${resumoPorTipoRota.length} tipos)`);
        }

        // UTILIT√ÅRIOS
        function formatarData(data) {
            return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
        }
    </script>
</body>
  <script>
    const acesso = localStorage.getItem("autenticado");
    if (acesso !== "sim") {
      const senha = prompt("Digite a senha para acessar:");
      if (senha === "Admin.2580") {
        localStorage.setItem("autenticado", "sim");
      } else {
        alert("Senha incorreta. Redirecionando...");
        window.location.href = "about:blank";
      }
    }
  </script>

  <h1>Bem-vindo!</h1>
  <p>Esse conte√∫do s√≥ aparece ap√≥s digitar a senha.</p>

  <button onclick="logout()">Sair</button>
  <script>
    function logout() {
      localStorage.removeItem("autenticado");
      location.reload();
    }

    function formatarData(data) {
      return new Date(data + 'T00:00:00').toLocaleDateString('pt-BR');
    }
  </script>
</body>
</html>